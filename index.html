<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>m3_test</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.46.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.46.0/mapbox-gl.css' rel='stylesheet' />
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@5/turf.min.js"></script>


    <style>
      body {
        margin: 0;
        padding: 0;
      }
            
      #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
      }

      .panel {
        position: fixed;
        top: 5px;
        left: 10px;   
        display: flex;
        flex-direction: column;    
        width: 200px;
        max-height: 100%;
        padding: 10px;
        z-index: 2;
        flex: 0 0 auto;    
        border-radius: 10px;
        margin: 7px;    
        font-family: Arial, Helvetica, sans-serif;
        font-weight: normal;  
        font-size: 14px;    
        background-color: #fff;    
        box-shadow: 0 10px 20px -10px rgba(0, 0, 0, 0.5);
       }
      
 #menu {
        background: #fff;
        display: flex;
        
        margin: 7px;
        border-radius: 3px;
        width: 120px;
        border: 1px solid rgba(0,0,0,0.4);
        
    }

    #menu a {
        font-size: 13px;
        color: #404040;
        display: block;
        margin: 0;
        padding: 0;
        padding: 10px;
        text-decoration: none;
        border-bottom: 1px solid rgba(0,0,0,0.25);
        text-align: center;
    }

    #menu a:last-child {
        border: none;
    }

    #menu a:hover {
        background-color: #f8f8f8;
        color: #404040;
    }

    #menu a.active {
        background-color: #3887be;
        color: #ffffff;
    }

    #menu a.active:hover {
        background: #3074a4;
    }

 

            
    </style>     
</head>
<body>
    
<!-- <div class='panel'>
    <div class='hourfilter'>
        <div class='button'>утро</div>
        <div class='button'>день</div>
        <div class='button'>вечер</div>
    </div>
</div>     -->

<!-- <div class='map-overlay-inner'>
    
</div> -->
   
<div id='map'></div>
<div class=panel>
    <label id='day_time'></label>
    <input id='slider' type='range' min='0' max='2' step='1' value='0' />
    <nav id="menu"></nav> 
    <div class='session' id='sliderbar'>
        <label id='active-hour'></label>
        <input id='slider' class='row' type='range' min='15' max='45' step='15' value='15' />
    </div> 
<div>
<script>

mapboxgl.accessToken = 'pk.eyJ1IjoibW9zY293Y2l0eW1hcCIsImEiOiJjajc3ZnQ1aGUxem41MzNudXU3MnBnZDA2In0.akDBtVzE-R3FgVs64ObGLg';
const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/moscowcitymap/cjiomhg5w29ta2sq80fv48hs2',
    center: [37.623140, 55.755509],
    minZoom: 9,
    maxZoom:18,
    zoom: 9.5
});

const points ={
"type": "FeatureCollection",
"crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:OGC:1.3:CRS84" } },
"features": [
{ "type": "Feature", "properties": { "id": 1, "longitude": 37.47751, "latitude": 55.68583, "point_id": 1 }, "geometry": { "type": "Point", "coordinates": [ 37.477512496004607, 55.685832401822807 ] } },
{ "type": "Feature", "properties": { "id": 2, "longitude": 37.5322, "latitude": 55.67862, "point_id": 2 }, "geometry": { "type": "Point", "coordinates": [ 37.532204229564648, 55.678622407845666 ] } },
{ "type": "Feature", "properties": { "id": 5, "longitude": 37.48132, "latitude": 55.64885, "point_id": 5 }, "geometry": { "type": "Point", "coordinates": [ 37.48132187048143, 55.648847939103604 ] } },
{ "type": "Feature", "properties": { "id": 6, "longitude": 37.61655, "latitude": 55.6731, "point_id": 6 }, "geometry": { "type": "Point", "coordinates": [ 37.61655466440849, 55.673098960290638 ] } }
]
}

var day_times = [
    'morning',
    'day',
    'evening'
];
 



map.on( 'load', () => {
    map.addSource('isochrones', {
            'type': 'geojson',
            'data': 'https://raw.githubusercontent.com/lena-emaya/m3routes/master/iso_4_merge.geojson'
    });
    map.addSource('points', {
            'type': 'geojson',
            'data': points
    });

    map.addSource('routes', {
        'type': 'geojson',
        'data': 'https://raw.githubusercontent.com/lena-emaya/m3routes/master/int.geojson'
    });

    


    map.addLayer({
        'id': 'isochrones',
        'type': 'fill',
        'source': 'isochrones',
        
        'paint': {
            'fill-color': '#088',
            'fill-opacity': 0
        }
    });

    map.addLayer({
        'id': 'isochrones-highlighted',
        'type': 'fill',
        'source': 'isochrones',
        
        'paint': {
            'fill-color':  [
               "case",
               [
                 "==",
                 ["get", "state"],
                 "current"
               ],
               "#50E7FF",
               [
                 "==",
                 ["get", "state"],
                 "plan"
               ],
               "hsla(216, 81%, 54%, 0.3)",
               "#000000"
            ],
            'fill-opacity': 0.5
        },
        'filter': ['==', ['number', ['get', 'srez']], 15]
    });


    document.getElementById('slider').addEventListener('input', function(e) {
        var srez = parseInt(e.target.value);
  // update the map
  map.setFilter('isochrones-highlighted', ['==', ['number', ['get', 'srez']], srez]);

  // converting 0-23 hour to AMPM format
  var ampm = hour >= 12 ? 'PM' : 'AM';
  var hour12 = hour % 12 ? hour % 12 : 12;

  // update text in the UI
  document.getElementById('active-hour').innerText = srez;
});


    map.addLayer({
        'id': 'isochrones-highlighted2',
        'type': 'line',
        'source': 'isochrones',
        
        'paint': {
            'line-color': [
               "case",
               [
                 "==",
                 ["get", "state"],
                 "current"
               ],
               "#36BCE3",
               [
                 "==",
                 ["get", "state"],
                 "plan"
               ],
               "hsl(216, 81%, 54%)",
               "#000000"
            ],
            "line-dasharray": [
               "step",
               ["zoom"],
               ["literal", [1, 1]],
               22,
               ["literal", [2, 1]]
            ],
            "line-width": [
              "interpolate",
              ["exponential", 1.3],
              ["zoom"],
              9,
              1,
              22,
              5
            ] 
        },
        'filter': ["in", "point_id", ""]
    });
    // map.addLayer({
    //     "id": "routes",
    //     "type": "line",
    //     "source": "routes",
    //     "paint": {
    //         "line-color": [
    //             "step",
    //             ["get", "percieved_interval"],
    //             "#E51746",
    //             11,
    //             "#FBBE2D",
    //             21,
    //             "#5478FF",
    //             30,
    //             "#73E382"
    //         ],
    //         "line-width":  [ 
    //                 "interpolate", 
    //                 [ 
    //                     "exponential",
    //                     1.15
    //                 ], 
    //                 [ 
    //                     "zoom"
    //                 ], 
    //                 10, 
    //                 [ 
    //                     "step", 
    //                     [ 
    //                         "get", 
    //                         "percieved_interval"
    //                     ],
    //                     1.5,
    //                     11,
    //                     1.1,
    //                     21,
    //                     0.75,
    //                     30,
    //                     0.55 
                        
    //                 ], 
    //                 20, 
    //                 [ 
    //                     "step", 
    //                     [ 
    //                         "get", 
    //                         "percieved_interval"
    //                     ], 
    //                     12,
    //                     11,
    //                     9,
    //                     21,
    //                     6,
    //                     30,
    //                     4 
    //                 ]
    //             ],
    //         "line-offset" : [ 
    //                 "interpolate", 
    //                 [ 
    //                     "exponential", 
    //                     1.35
    //                 ], 
    //                 [ 
    //                     "zoom"
    //                 ], 
    //                 10, 
    //                 [ 
    //                     "interpolate", 
    //                     [ 
    //                         "linear"
    //                     ], 
    //                     [ 
    //                         "get", 
    //                         "percieved_interval"
    //                     ], 
    //                     11,
    //                     1.5,
    //                     21,
    //                     0.5,
    //                     30,
    //                     0
    //                 ], 
    //                 14, 
    //                 [ 
    //                     "interpolate", 
    //                     [ 
    //                         "linear"
    //                     ], 
    //                     [ 
    //                         "get", 
    //                         "percieved_interval"
    //                     ], 
    //                     11,
    //                     4,
    //                     21,
    //                     2,
    //                     30,
    //                     0
    //                 ], 
    //                 19, 
    //                 [ 
    //                     "interpolate", 
    //                     [ 
    //                         "linear"
    //                     ], 
    //                     [ 
    //                         "get", 
    //                         "percieved_interval"
    //                     ], 
    //                     11,
    //                     10.5,
    //                     21,
    //                     5.5,
    //                     30,
    //                     0
    //                 ]
    //             ]
    //     }
    // })


    map.addLayer({
        "id": "interaval_31",
        "type": "line",
        "source": "routes",
        "filter": [">", ["number",["get", "percieved_interval"]], 31 ],
        "paint": {
            "line-color": "#6ce98f",
            "line-width": [
                "interpolate",
                ["exponential", 1.21],
                ["zoom"],
                9,
                1,
                22,
                12
            ]
        },
        "layout": {
            "line-join": "round"
        }
    });


    map.addLayer({
        "id": "interaval_30",
        "type": "line",
        "source": "routes",
        "filter": ["all", ["<=", ["number",["get", "percieved_interval"]], 30 ], [">", ["number",["get", "percieved_interval"]], 21 ]],
        "paint": {
            "line-color": "#59bdf7",
            "line-width": [
                "interpolate",
                ["exponential", 1.21],
                ["zoom"],
                9,
                1.1,
                22,
                15
            ]
        },
        "layout": {
            "line-join": "round"
        }
    });


    map.addLayer({
        "id": "interaval_20",
        "type": "line",
        "source": "routes",
        "filter": ["all", ["<=", ["number",["get", "percieved_interval"]], 20 ], [">", ["number",["get", "percieved_interval"]], 11 ]],
        "paint": {
            "line-color": "#ffa400",
            "line-width": [
                "interpolate",
                ["exponential", 1.21],
                ["zoom"],
                9,
                1.35,
                22,
                20
            ]
        },
        "layout": {
            "line-join": "round"
        }
    });
    
    
    map.addLayer({
        "id": "interaval_10",
        "type": "line",
        "source": "routes",
        "filter": ["<=", ["number",["get", "percieved_interval"]], 10],
        "paint": {
            "line-color": "#ed0749",
            "line-width": [
                "interpolate",
                ["exponential", 1.21],
                ["zoom"],
                9,
                2.2,
                22,
                30
            ]
        },
        "layout": {
            "line-join": "round"
        }
    });

    map.addLayer({
        "id": "point",
        "type": "circle",
        "source": "points",
        "paint": {
            "circle-radius": 4,
            "circle-color": "#5C82FF",
            "circle-stroke-color": "#fff",
            "circle-stroke-width": 1
        }
    });

    
    



   
});




</script>

</body>
</html>
